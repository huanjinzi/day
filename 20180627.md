# 2018.06.27 星期三 雨
--

## init.rc
1.service
定义服务
```
service ueventd /sbin/ueventd
    class core
    critical
    seclabel u:r:ueventd:s0
```
2.on
启动服务
```
on property:sys.init_log_level=*
    loglevel ${sys.init_log_level}
```

## 如何检查内核config生效
执行`make xxxconfig`之后，会生成`SRC_ROOT/kernel/.config`，在`SRC_ROOT/kernel/.config`文件中检查配置是否生效

## Android源码system目录
```
user debug eng 
LOCAL_MODULE_TAGS := debug
```
会根据`LOCAL_MODULE_TAGS`是否编译模块，默认是`optional`

## Android Low Memory Killer
AMS与`system/core/lmkd`交互
```
/sys/module/lowmemorykiller/parameters/minfree：里面是以”,”分割的一组数，每个数字代表一个内存级别
/sys/module/lowmemorykiller/parameters/adj：对应上面的一组数，每个数组代表一个进程优先级级别
例：
/sys/module/lowmemorykiller/parameters/minfree：18432,23040,27648,32256,55296,80640
/sys/module/lowmemorykiller/parameters/adj：0,100,200,300,900,906
```
三种命令：
```
LMK_TARGET：更新/sys/module/lowmemorykiller/parameters/中的minfree以及adj
LMK_PROCPRIO：更新指定进程的优先级，也就是oom_score_adj
LMK_PROCREMOVE：移除进程
```
## android.os.FileObserver
可以监控文件访问等信息,通过`inotify`实现，`jni`可以动态注册，`jni.h`中的`JNINativeMethod`结构其
```java
static const JNINativeMethod gMethods[] = {
...
    {"start",            "()V",      (void *)android_media_MediaRecorder_start},//1
    {"stop",             "()V",      (void *)android_media_MediaRecorder_stop},
    {"pause",            "()V",      (void *)android_media_MediaRecorder_pause},
    {"resume",           "()V",      (void *)android_media_MediaRecorder_resume},
    {"native_reset",     "()V",      (void *)android_media_MediaRecorder_native_reset},
    {"release",          "()V",      (void *)android_media_MediaRecorder_release},
    {"native_init",      "()V",      (void *)android_media_MediaRecorder_native_init},
   ...
};
```

## Android JNI动态注册流程
```
1.jint JNI_OnLoad()
2.register_xxx_xxx()
3.RegisterMethodsOrDie(JNINativeMethod)
```
如果没有发现`JNI_OnLoad`，那么，相应的注册函数在`frameworks/base/core/jni/AndroidRuntime.cpp`中进行注册

刚好，整个`jni`调用流程出来了

## Android编译脚本

1.`make`命令的文件起点`$(AOSP)/Makefile`
```sh
### DO NOT EDIT THIS FILE ###
include build/core/main.mk
### DO NOT EDIT THIS FILE ###
```
2.`build/core/main.mk`
```sh
# Check for broken versions of make.

```
